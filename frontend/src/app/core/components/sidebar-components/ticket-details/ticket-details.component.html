<app-sidebar-menu [menuItems]="menuItems" [menuTitle]="menuTitle" [menuIcon]="menuIcon"
  (page)="onPageChange($event)"></app-sidebar-menu>

<header class="widget details">
  <h1 class="title">Ticket {{ticketDetails.number}}:<span class="title-name"> {{ticketDetails.name}} </span>
  </h1>
  <div class="details-profil">
    <p class="prefix">Auteur:</p>
    <app-avatar [userName]="ticketDetails.fullnameAuthor" class="context-ticket-card-creator"></app-avatar>
    <p class="name"> {{ticketDetails.authorLastname}}<span class="firstname">{{ticketDetails.authorFirstname}}</span>
    </p>
  </div>
  <p class="prefix">Catégorie: <span class="category-span">{{ticketDetails.category}}</span></p>
  <p class="prefix">Statut: <span [ngClass]="statutSpan">{{ticketDetails.status}}</span></p>
  <p class="prefix">Priorité: <span [ngClass]="prioritySpan"> {{ticketDetails.priority}} </span></p>
  <div class="date-c">
    <p class="prefix date">Date de création: <span>{{ ticketDetails.creationDate | date: 'dd MMMM yyyy' }}</span></p>
    @if (ticket.archiveDate) {
      <p class="prefix date">
        Date d'archivage: <span>{{ ticket.archiveDate | date: 'dd MMMM yyyy' }}</span>
      </p>
    } 
    @if (ticketDetails.updateDate) {
      <p class="prefix date">Date de modification: {{ticketDetails.updateDate | date:'dd/MM/yyyy' }}</p>
    }
  </div>
  <ng-container *ngIf="page ==='Info'">
    <article [@opacity]="page==='Info'?'active':''">
      <p class="prefix description">Description:</p>
      <p>{{ ticketDetails.description}}</p>
    </article>
  </ng-container>

  <section class="card-bottom">
    <ng-container *ngIf="ticketDetails.developers.length >=1">
      <p class="prefix">Développeurs:</p>
      <ul>
        <li *ngFor="let developer of ticketDetails.developers">{{ developer }}</li>
      </ul>
    </ng-container>
  </section>
</header>


<container-element [ngSwitch]="page">
  <ng-container *ngSwitchCase="'Chat'">
    <section class="widget" [@opacity]="page==='Chat'?'active':''">
      <app-ticket-chat></app-ticket-chat>
    </section>
  </ng-container>
  <ng-container *ngSwitchCase="'Actions'">
    <section class="widget actions" [@opacity]="page==='Actions'?'active':''">
      <h1 class="weight-500">Actions sur le ticket</h1>
      <div class="actions-btn">
        <ng-container *ngIf="this.ticketDetails.status !== 'Terminé'">
          <button mat-raised-button color="primary" class="btn bi bi-check-lg" (click)="closeTicket()">Cloturer</button>
        </ng-container>
        <ng-container *ngIf="this.ticketDetails.status === 'Terminé'">
          <button mat-raised-button color="primary" class="btn bi bi-check-lg" (click)="reopenTicket()">Rouvrir</button>
        </ng-container>

        <ng-container *ngIf="this.ticketDetails.archiveDate === ''">
          <button mat-raised-button color="accent" class="btn bi bi-file-earmark-zip-fill"
            (click)="archiveTicket(this.ticket!.id)">Archiver</button>
        </ng-container>

        <ng-container *ngIf="this.ticketDetails.archiveDate !== ''">
          <button mat-raised-button color="accent" class="btn bi bi-file-earmark-zip-fill"
            (click)="unarchiveTicket(this.ticket!.id)">Désarchiver</button>
        </ng-container>
      </div>
    </section>
  </ng-container>
</container-element>